<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Interview</title>
	<!-- CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<style>
		.transcript {
			font-size: 1.2rem;
			margin-top: 2rem;
		}
		.highlight {
			background-color: yellow;
			font-weight: bold;
		}
	</style>
</head>
<body>
	<div class="container mt-5">
		<!-- Audio Player -->
		<div class="row">
			<div class="col-md-8 offset-md-2">
				<div id="player"></div>
			</div>
		</div>
		<!-- Transcript -->
		<div class="row">
			<div class="col-md-8 offset-md-2 transcript">
				<p id="transcript"></p>
			</div>
		</div>
	</div>

	<!-- JavaScript -->
    <script src="https://unpkg.com/wavesurfer.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.0/howler.min.js"></script>
	<script>
		// Audio Player
		var sound = new Howl({
			src: ['audio/Interview_002.m4a'],
			html5: true
		});
		var player = WaveSurfer.create({
			container: '#player',
			waveColor: 'gray',
			progressColor: 'black',
			cursorColor: 'black',
			barWidth: 2,
			barHeight: 4,
			barGap: 1
		});
		player.load('audio/Interview_002.m4a');
		player.on('ready', function () {
			player.play();
		});
		player.on('play', function () {
			sound.play();
		});
		player.on('pause', function () {
			sound.pause();
		});
		sound.on('end', function () {
			player.pause();
			player.seekTo(0);
		});

		// Transcript
		var transcriptEl = document.getElementById('transcript');
		fetch('transcript/Interview_002.m4a_large.tsv')
			.then(response => response.text())
			.then(data => {
				var rows = data.trim().split('\n').slice(1); // remove header
				var words = rows.map(row => row.split('\t')[2]); // get text column
				var times = rows.map(row => parseFloat(row.split('\t')[0])); // get start times
				var currentIndex = 0;
				player.on('audioprocess', function () {
					if (player.getCurrentTime() > times[currentIndex + 1]) {
						currentIndex++;
						transcriptEl.innerHTML = words[currentIndex - 1]; // update transcript
						var prevWordEl = transcriptEl.querySelector('.highlight');
						if (prevWordEl) {
							prevWordEl.classList.remove('highlight'); // remove previous highlight
						}
						var currentWordEl = transcriptEl.querySelector(`:nth-child(${currentIndex})`);
						currentWordEl.classList.add('highlight'); // highlight current word
					}
				});
			});
	</script>
</body>
</html>